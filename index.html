<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js - Видео на изображении</title>
    
    <!-- Подключаем A-Frame и AR.js с поддержкой Image Tracking -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <script>
        // Обработчик событий для изображения
        AFRAME.registerComponent('video-handler', {
            init: function() {
                const el = this.el;
                const video = document.querySelector('#my-video');
                
                // При обнаружении изображения
                el.addEventListener('markerFound', function() {
                    console.log('Изображение найдено');
                    video.play();
                });
                
                // При потере изображения
                el.addEventListener('markerLost', function() {
                    console.log('Изображение потеряно');
                    video.pause();
                });
            }
        });
    </script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; trackingMethod: best;">
        
        <!-- Используем NFT (Natural Feature Tracking) для отслеживания изображения -->
        <a-nft
            type="nft"
            url="placeholder"
            smooth="true"
            smoothCount="10"
            smoothTolerance=".01"
            smoothThreshold="5"
            video-handler>
            
            <!-- Видео контейнер -->
            <a-video
                src="#my-video"
                position="0 0 0"
                rotation="-90 0 0"
                width="1.5"
                height="1">
            </a-video>
        </a-nft>
        
        <!-- Камера с ограничениями на дистанцию для лучшей производительности -->
        <a-entity camera></a-entity>
        
        <!-- Предварительная загрузка видео -->
        <video
            id="my-video"
            src="vid.mp4"
            preload="auto"
            loop="true"
            crossorigin="anonymous"
            muted
            playsinline
            style="display: none;">
        </video>
    </a-scene>
</body>
</html>